@prefix c: <http://www.semanticweb.org/yzhao30/ontologies/2015/7/c#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix pa: <http://www.semanticweb.org/aidb/ontologies/BugFindingOntology#> .

#fread doesn't precede fclose

pa:queryList pa:contains pa:0_0 .
pa:0_0 rdf:type pa:query .
pa:0_0 pa:queryType pa:EnumQuery.
pa:0_0 pa:programPointSettings pa:preCall .
pa:0_0 pa:queryModel pa:SPARQL .
pa:0_0 pa:hasQuery pa:0_2 .
pa:0_2 pa:value '''SELECT DISTINCT ?exp 
        WHERE {
                ?exp rdf:type c:ExpressionStatement.
#		?exp c:hasExpression/c:call/c:hasName 'fclose'.
		?exp c:hasExpression ?func.
              ?func rdf:type c:FunctionCall.
		?func c:call ?call.
		?call rdf:type c:FunctionRef.
		?call c:hasName 'fclose'.
		?func c:hasArgumentExpr ?y.
		?y c:NthArg '0'.
		?y c:referTo ?var.

		OPTIONAL{
                ?exp2 rdf:type c:ExpressionStatement.
#		?exp2 c:hasExpression/c:call/c:hasName 'fread'.
?exp2 c:hasExpression ?func2.
              ?func2 rdf:type c:FunctionCall.
		?func2 c:call ?call2.
		?call2 rdf:type c:FunctionRef.
		?call2 c:hasName 'fscanf'.
		?func2 c:hasArgumentExpr ?y2.
		?y2 c:NthArg '0'.
		?y2 c:referTo ?var.
		?exp2 (pa:nextStatement|pa:nextTrueStatement|pa:nextFalseStatement)* ?exp.
		}

		Filter(!bound(?exp2))

            }''' .
